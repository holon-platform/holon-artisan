<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../../../../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../../../../../bower_components/vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../../../../../../../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../../../../../../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../../../../../../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../../../../../../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../../../../../../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../../../../../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../../../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../../../../../bower_components/iron-media-query/iron-media-query.html">

<dom-module id="holon-app-layout">
    <template>
        <style>

            :root {
                --primary-color: var(--app-layout-primary-color);
                --app-drawer-scrim-background: rgba(0, 0, 0, 0);
            }
            
            :host {
                width: 100%;
                height: 100%;
            } 

            app-header {
                right: 0px !important;
                top: 0px;
                height: var(--app-layout-header-height);
                background: var(--app-layout-header-background-base-color);
            }

            app-toolbar {
                height: var(--app-layout-header-height);
                background: var(--app-layout-header-background-color);
                box-shadow: var(--app-layout-header-shadow);
                color: var(--app-layout-header-font-color);
                padding-top: 0;
                padding-bottom: 0;
                padding-left: 16px;
                padding-right: var(--app-layout-header-padding-right);
                z-index: 1;
                position: absolute;
                top: 0px;
                left: 0px;
                right: 0px;
            }

            #drawer {
                margin-top: var(--app-layout-header-height);
            }

            #drawer #drawer-content {
                height: 100%;
                width: 100%;
                background: var(--app-layout-drawer-background-color);
                box-shadow: var(--app-layout-drawer-shadow);
                background-color: var(--app-layout-drawer-background-base-color);
                max-width: 100%;
                transition: 1s width;
                overflow-y: auto;
                overflow-x: hidden;
            }

            #toggle-menu {
                flex-shrink: 0;
                width: calc(var(--app-layout-header-height) - 16px);
                height: calc(var(--app-layout-header-height) - 16px);
                margin-right: 8px;
                margin-left: -8px;
            }

            :host(:not([narrow])) #toggle-menu {
                display: none; 
            }
            
            #header-title {
                height: 100%;
                flex-grow: 1;
                overflow: hidden;
            }
            
            #header-context-actions {
                height: 100%;
                overflow: hidden;
            }
            
            #header-actions {
                height: 100%;
                overflow: hidden;
                flex-shrink: 0;
                padding-left: var(--app-layout-header-actions-space);
            }
            
            #application-content {
                width: 100%;
                height: 100%;
                padding-top: var(--app-layout-header-height);
                box-sizing: border-box;
                overflow: auto;
                background: var(--app-layout-background);
            }
            
            :host(:not([narrow])[theme~="small"]) #drawer-layout {
                --app-drawer-width: var(--app-layout-drawer-small-width);
            }
            
            :host(:not([footer])) #application-footer {
              display: none;
            }
            
            :host([footer]) #application-footer {
              position: absolute;
              bottom: 0px;
              left: 0px;
              right: 0px; 
              height: var(--app-layout-footer-height);
              box-shadow: var(--app-layout-footer-shadow);
              background: var(--app-layout-footer-background-color);
              color: var(--app-layout-footer-font-color);
              padding-top: 0;
              padding-bottom: 0;
              padding-left: var(--app-layout-footer-padding);
              padding-right: var(--app-layout-footer-padding);
              overflow: hidden;
            }
            
            :host(:not([narrow])[footer]) #application-footer {
              display: none;
            }
            
            :host([narrow][footer]) #application-footer {
              display: block;
            }
            
            :host([narrow][footer]) #application-content {
              padding-bottom: var(--app-layout-footer-height);
            }
      
        </style>
        <app-header-layout id="layout-wrapper" fullbleed>
            <app-header fixed part="header" slot="header">
                <app-toolbar>
					<paper-icon-button id="toggle-menu" icon="vaadin:menu" on-tap="_toggle"></paper-icon-button>
                    <div id="header-title">
                        <slot name="header-title"></slot>
                    </div>
                    <div id="header-context-actions">
                        <slot name="header-context-actions"></slot>
                    </div>
                    <div id="header-actions">
                        <slot name="header-actions"></slot>
                    </div>
                </app-toolbar>
            </app-header>
            <app-drawer-layout id="drawer-layout" fullbleed>
                <app-drawer part="drawer" id="drawer" slot="drawer" swipe-open>
                    <div id="drawer-content">
                        <slot name="drawer-content"></slot>
                    </div>
                </app-drawer>
                <div id="application-content" size="100" part="application-content">
                    <slot name="application-content"></slot>
                </div>
                <div id="application-footer" part="application-footer">
                  <slot name="application-footer"></slot>
                </div>
            </app-drawer-layout>
        </app-header-layout>
        <iron-media-query query="[[_computeMediaQuery(responsiveWidth)]]" on-query-matches-changed="_onQueryMatchesChanged"></iron-media-query>
    </template>
    <script>
        class HolonAppLayout extends Vaadin.ThemableMixin(Polymer.Element){
            static get is() {
                return 'holon-app-layout'
            }

            static get properties() {
                return {
                    responsiveWidth: {
                        type: String,
                        value: "640px",
                        observer: "_responsiveWidthChanged"
                    }
                };
            }

            _toggle() {
               Polymer.dom(this.root).querySelector("#drawer").toggle();
            }
            
            closeIfNotPersistent() {
            	 var drawer = Polymer.dom(this.root).querySelector("#drawer");
                 if (!drawer.persistent) {
                	 drawer.close();
                 }
            }

            _responsiveWidthChanged() {
                Polymer.dom(this.root).querySelector("#drawer-layout").responsiveWidth = this.responsiveWidth;
            }

            _onQueryMatchesChanged(event) {
                if (event.detail.value) {
                    this.setAttribute("narrow", "");
                } else {
                    this.removeAttribute("narrow");
                }
                this.onNarrowStateChange(event);
            }
            
            onNarrowStateChange(event){}

            _computeMediaQuery(responsiveWidth) {
                return "(max-width: " + responsiveWidth + ")";
            }
        }

        customElements.define(HolonAppLayout.is, HolonAppLayout);
    </script>
</dom-module>